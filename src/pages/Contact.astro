---
import BaseLayout from "../layouts/BaseLayout.astro";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
---

<BaseLayout title="お問い合わせ | WebChaleur">
  <Header />

  <!-- ヒーローセクション -->
  <section
    class="pt-32 pb-20 bg-gradient-to-b from-gray-900 to-indigo-900/80 overflow-hidden"
  >
    <div class="container px-6 mx-auto">
      <div class="max-w-4xl mx-auto text-center">
        <!-- 戻るリンク -->
        <a
          href="/"
          class="inline-flex items-center text-sm text-indigo-400 hover:text-indigo-300 mb-8 transition-colors"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-4 w-4 mr-2"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
          </svg>
          ホームに戻る
        </a>

        <!-- タイトルとサブタイトル -->
        <div class="mb-8">
          <div
            class="inline-block px-3 py-1 mb-4 text-xs tracking-wider text-indigo-300 uppercase bg-indigo-900/50 backdrop-blur-sm border border-indigo-800 rounded-sm"
          >
            Contact
          </div>
          <h1 class="text-3xl md:text-4xl font-light text-white">
            お気軽に<span class="text-indigo-400">お問い合わせ</span>ください
          </h1>
          <p class="text-gray-300 font-light mt-4 max-w-2xl mx-auto">
            ホームページ制作やWebマーケティングについてのご質問、お見積りのご依頼など、
            お気軽にお問い合わせください。通常2営業日以内にご返信いたします。
          </p>
        </div>
      </div>
    </div>

    <!-- 装飾的な波形 -->
    <div class="absolute bottom-0 left-0 w-full overflow-hidden">
      <svg
        class="absolute bottom-0 left-0 w-full"
        height="40"
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 1440 40"
        preserveAspectRatio="none"
      >
        <path
          fill="#0F172A"
          d="M0,15 L48,13 C96,11,192,7,288,9 C384,11,480,19,576,22 C672,25,768,23,864,19 C960,15,1056,9,1152,9 C1248,9,1344,15,1392,18 L1440,21 L1440,40 L1392,40 C1344,40,1248,40,1152,40 C1056,40,960,40,864,40 C768,40,672,40,576,40 C480,40,384,40,288,40 C192,40,96,40,48,40 L0,40 Z"
        >
        </path>
      </svg>
    </div>
  </section>

  <!-- メインコンテンツ -->
  <section id="contact" class="py-20 bg-gray-950">
    <div class="container px-6 mx-auto">
      <div class="max-w-5xl mx-auto">
        <div class="grid grid-cols-1 gap-8">
          <!-- 問い合わせフォーム -->
          <div>
            <h2 class="text-2xl font-light text-white mb-8">
              お問い合わせフォーム
            </h2>

            <form
              id="contactForm"
              class="space-y-6"
              action="https://api.web3forms.com/submit"
              method="POST"
            >
              <!-- 送信先メールアドレス (Web3Formsの場合はアクセスキーを入れる) -->
              <input
                type="hidden"
                name="access_key"
                value="YOUR_ACCESS_KEY_HERE"
              />
              <input
                type="hidden"
                name="subject"
                value="WebChaleurへのお問い合わせ"
              />
              <input type="hidden" name="redirect" value="/thank-you" />

              <!-- お名前 -->
              <div>
                <label for="name" class="block text-sm text-gray-300 mb-2"
                  >お名前 <span class="text-red-500">*</span></label
                >
                <input
                  id="name"
                  name="name"
                  type="text"
                  required
                  class="w-full px-4 py-3 bg-white/5 border border-white/10 rounded-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-white"
                  placeholder="山田 太郎"
                />
              </div>

              <!-- 会社名 -->
              <div>
                <label for="company" class="block text-sm text-gray-300 mb-2"
                  >会社名</label
                >
                <input
                  id="company"
                  name="company"
                  type="text"
                  class="w-full px-4 py-3 bg-white/5 border border-white/10 rounded-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-white"
                  placeholder="株式会社〇〇"
                />
              </div>

              <!-- メールアドレス -->
              <div>
                <label for="email" class="block text-sm text-gray-300 mb-2"
                  >メールアドレス <span class="text-red-500">*</span></label
                >
                <input
                  id="email"
                  name="email"
                  type="email"
                  required
                  class="w-full px-4 py-3 bg-white/5 border border-white/10 rounded-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-white"
                  placeholder="your-email@example.com"
                />
              </div>

              <!-- 電話番号 -->
              <div>
                <label for="phone" class="block text-sm text-gray-300 mb-2"
                  >電話番号</label
                >
                <input
                  id="phone"
                  name="phone"
                  type="tel"
                  class="w-full px-4 py-3 bg-white/5 border border-white/10 rounded-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-white"
                  placeholder="090-1234-5678"
                />
              </div>

              <!-- お問い合わせ種類 -->
              <div>
                <label for="subject" class="block text-sm text-gray-300 mb-2"
                  >お問い合わせ種類 <span class="text-red-500">*</span></label
                >
                <select
                  id="subject"
                  name="subject"
                  required
                  class="w-full px-4 py-3 bg-white/5 border border-white/10 rounded-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-white"
                >
                  <option value="">選択してください</option>
                  <option value="Webサイト制作">Webサイト制作</option>
                  <option value="ECサイト制作">ECサイト制作</option>
                  <option value="Webマーケティング">Webマーケティング</option>
                  <option value="SNS運用サポート">SNS運用サポート</option>
                  <option value="その他">その他</option>
                </select>
              </div>

              <!-- お問い合わせ内容 -->
              <div>
                <label for="message" class="block text-sm text-gray-300 mb-2"
                  >お問い合わせ内容 <span class="text-red-500">*</span></label
                >
                <textarea
                  id="message"
                  name="message"
                  required
                  rows="6"
                  class="w-full px-4 py-3 bg-white/5 border border-white/10 rounded-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-white resize-none"
                  placeholder="ご質問やご要望をお聞かせください"></textarea>
              </div>

              <!-- プライバシーポリシー同意 -->
              <div class="flex items-start">
                <div class="flex items-center h-5">
                  <input
                    id="privacy"
                    name="privacy"
                    type="checkbox"
                    required
                    class="w-4 h-4 bg-white/5 border border-white/10 rounded focus:ring-indigo-500 focus:ring-2"
                  />
                </div>
                <div class="ml-3 text-sm">
                  <label for="privacy" class="text-gray-300">
                    <a
                      href="/privacy-policy"
                      class="text-indigo-400 hover:text-indigo-300"
                      >プライバシーポリシー</a
                    >に同意します <span class="text-red-500">*</span>
                  </label>
                </div>
              </div>

              <!-- 送信ボタン -->
              <div>
                <button
                  type="submit"
                  id="submitButton"
                  class="w-full px-6 py-4 text-sm font-medium tracking-wider uppercase text-white bg-indigo-600 rounded-sm hover:bg-indigo-700 transition-colors focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2"
                >
                  <span>送信する</span>
                  <span id="loadingIcon" class="hidden ml-2">
                    <svg
                      id="loadingSvg"
                      class="h-5 w-5 text-white"
                      xmlns="http://www.w3.org/2000/svg"
                      fill="none"
                      viewBox="0 0 24 24"
                    >
                      <circle
                        class="opacity-25"
                        cx="12"
                        cy="12"
                        r="10"
                        stroke="currentColor"
                        stroke-width="4"></circle>
                      <path
                        class="opacity-75"
                        fill="currentColor"
                        d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
                      ></path>
                    </svg>
                  </span>
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </section>

  <Footer />

  <!-- FAQ用のJavaScript -->
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const faqQuestions = document.querySelectorAll(".faq-question");

      faqQuestions.forEach((question) => {
        question.addEventListener("click", () => {
          const faqItem = question.parentElement;
          const answer = question.nextElementSibling as HTMLElement;
          const isActive = faqItem?.classList.contains("active");

          // 全てのFAQを閉じる
          document.querySelectorAll(".faq-item").forEach((item) => {
            item.classList.remove("active");
            const itemAnswer = item.querySelector(".faq-answer") as HTMLElement;
            if (itemAnswer) {
              itemAnswer.style.maxHeight = "0";
            }
          });

          // クリックされた項目が閉じられていれば開く
          if (!isActive && faqItem && answer) {
            faqItem.classList.add("active");
            answer.style.maxHeight = answer.scrollHeight + "px";
            question.setAttribute("aria-expanded", "true");
          } else {
            question.setAttribute("aria-expanded", "false");
          }
        });
      });
    });
  </script>

  <!-- フォームバリデーションのJavaScript -->
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const form = document.getElementById("contactForm") as HTMLFormElement;
      const submitButton = document.getElementById(
        "submitButton"
      ) as HTMLButtonElement;
      const loadingIcon = document.getElementById("loadingIcon");

      if (form) {
        form.addEventListener("submit", function (event) {
          // 必須項目のチェック
          const requiredFields = form.querySelectorAll("[required]");
          let isValid = true;

          requiredFields.forEach((field) => {
            const inputField = field as
              | HTMLInputElement
              | HTMLTextAreaElement
              | HTMLSelectElement;
            if (!inputField.value.trim()) {
              isValid = false;
              field.classList.add("border-red-500");

              // エラーメッセージの追加（まだなければ）
              const errorId = `error-${field.id}`;
              if (!document.getElementById(errorId) && field.parentNode) {
                const errorElement = document.createElement("p");
                errorElement.id = errorId;
                errorElement.className = "text-red-500 text-sm mt-1";
                errorElement.textContent = "必須項目です";
                field.parentNode.appendChild(errorElement);
              }
            } else {
              field.classList.remove("border-red-500");

              // エラーメッセージの削除（あれば）
              const errorElement = document.getElementById(`error-${field.id}`);
              if (errorElement && errorElement.parentNode) {
                errorElement.parentNode.removeChild(errorElement);
              }
            }
          });

          // メールアドレスの検証
          const emailField = document.getElementById(
            "email"
          ) as HTMLInputElement;
          if (emailField && emailField.value.trim()) {
            const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailPattern.test(emailField.value)) {
              isValid = false;
              emailField.classList.add("border-red-500");

              // エラーメッセージの追加（まだなければ）
              const errorId = `error-${emailField.id}`;
              if (!document.getElementById(errorId) && emailField.parentNode) {
                const errorElement = document.createElement("p");
                errorElement.id = errorId;
                errorElement.className = "text-red-500 text-sm mt-1";
                errorElement.textContent =
                  "有効なメールアドレスを入力してください";
                emailField.parentNode.appendChild(errorElement);
              }
            }
          }

          // バリデーションに失敗した場合は送信を中止
          if (!isValid) {
            event.preventDefault();
          } else {
            // 送信中の表示
            if (submitButton && loadingIcon) {
              submitButton.disabled = true;
              const buttonText = submitButton.querySelector("span:first-child");
              if (buttonText) {
                buttonText.textContent = "送信中...";
              }
              loadingIcon.classList.remove("hidden");
              const loadingSvg = document.getElementById("loadingSvg");
              if (loadingSvg) {
                loadingSvg.classList.add("animate-spin");
              }
            }
          }
        });

        // フォーカスが外れたときにバリデーションを行う
        const fields = form.querySelectorAll("input, textarea, select");
        fields.forEach((field) => {
          field.addEventListener("blur", function () {
            const inputField = field as
              | HTMLInputElement
              | HTMLTextAreaElement
              | HTMLSelectElement;

            // 必須項目の場合
            if (field.hasAttribute("required") && !inputField.value.trim()) {
              field.classList.add("border-red-500");

              // エラーメッセージの追加（まだなければ）
              const errorId = `error-${field.id}`;
              if (!document.getElementById(errorId) && field.parentNode) {
                const errorElement = document.createElement("p");
                errorElement.id = errorId;
                errorElement.className = "text-red-500 text-sm mt-1";
                errorElement.textContent = "必須項目です";
                field.parentNode.appendChild(errorElement);
              }
            } else {
              field.classList.remove("border-red-500");

              // エラーメッセージの削除（あれば）
              const errorElement = document.getElementById(`error-${field.id}`);
              if (errorElement && errorElement.parentNode) {
                errorElement.parentNode.removeChild(errorElement);
              }
            }

            // メールアドレスの場合
            if (field.id === "email" && inputField.value.trim()) {
              const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
              if (!emailPattern.test(inputField.value)) {
                field.classList.add("border-red-500");

                // エラーメッセージの追加（まだなければ）
                const errorId = `error-${field.id}`;
                if (!document.getElementById(errorId) && field.parentNode) {
                  const errorElement = document.createElement("p");
                  errorElement.id = errorId;
                  errorElement.className = "text-red-500 text-sm mt-1";
                  errorElement.textContent =
                    "有効なメールアドレスを入力してください";
                  field.parentNode.appendChild(errorElement);
                }
              }
            }
          });
        });
      }
    });
  </script>
</BaseLayout>
